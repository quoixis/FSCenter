<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:FSCenter.ViewModels"
             x:Class="FSCenter.Views.AttendanceView"
             x:DataType="vm:AttendanceViewModel"
             Background="White">
    
    <StackPanel Margin="20" Spacing="20">
        
        <Grid ColumnDefinitions="*,Auto">
            <TextBlock Text="Відвідування" FontSize="24" FontWeight="Bold" Foreground="Black"/>
            <Border Grid.Column="1" Background="#E3F2FD" CornerRadius="8" Padding="10,5">
                <StackPanel Orientation="Horizontal" Spacing="5">
                    <TextBlock Text="Сьогодні:" FontSize="13" Foreground="#1976D2"/>
                    <TextBlock Text="{Binding TotalVisitsToday}" FontSize="13" Foreground="#1976D2" FontWeight="Bold"/>
                </StackPanel>
            </Border>
        </Grid>
        
        <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="10">
            <TextBox Grid.Column="0"
                    Text="{Binding SearchText}"
                    Height="35"
                    Watermark="ID або прізвище"
                    FontSize="14">
                <TextBox.KeyBindings>
                    <KeyBinding Gesture="Enter" Command="{Binding SearchCommand}"/>
                </TextBox.KeyBindings>
            </TextBox>
            <Button Grid.Column="1" Content="Пошук" Command="{Binding SearchCommand}" Padding="20,8"/>
            <Button Grid.Column="2" Content="Очистити" Command="{Binding ClearCommand}" Padding="15,8"/>
        </Grid>
        
        <Border Background="#FFF3E0" CornerRadius="5" Padding="10">
            <TextBlock Text="Відмічати відвідування можна тільки на сьогоднішню дату" 
                      FontSize="13" 
                      Foreground="#E65100" 
                      FontWeight="SemiBold"/>
        </Border>
        
        <Border Background="#F5F5F5" CornerRadius="5" Padding="10">
            <TextBlock Text="{Binding StatusMessage}" FontSize="14" Foreground="Gray" TextAlignment="Center"/>
        </Border>
        
        <Border BorderBrush="#CCCCCC" BorderThickness="1" CornerRadius="5" IsVisible="{Binding HasResults}">
            <ScrollViewer>
                <ItemsControl ItemsSource="{Binding Memberships}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border BorderBrush="#EEEEEE" BorderThickness="0,0,0,1" Padding="15">
                                <StackPanel Spacing="10">
                                    <Grid ColumnDefinitions="Auto,*,Auto,Auto" ColumnSpacing="15">
                                        
                                        <Border Grid.Column="0" Background="#E3F2FD" CornerRadius="5" Padding="8">
                                            <StackPanel>
                                                <TextBlock Text="ID" FontSize="10" Foreground="#1976D2" HorizontalAlignment="Center"/>
                                                <TextBlock Text="{Binding ClientId}" FontSize="16" FontWeight="Bold" Foreground="#1976D2" HorizontalAlignment="Center"/>
                                            </StackPanel>
                                        </Border>
                                        
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding ClientName}" FontSize="16" FontWeight="SemiBold" Foreground="Black"/>
                                            <TextBlock Text="{Binding ClientPhone}" FontSize="13" Foreground="Gray"/>
                                            <TextBlock Text="{Binding ClubName}" FontSize="11" Foreground="#E65100"/>
                                            <TextBlock Text="{Binding MembershipPeriod}" FontSize="11" Foreground="#1976D2" FontWeight="SemiBold"/>
                                            <TextBlock Text="{Binding TimeFormatted}" FontSize="11" Foreground="#666" IsVisible="{Binding IsPresent}"/>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Column="2" VerticalAlignment="Center">
                                            <TextBlock Text="Залишилось" FontSize="11" Foreground="Gray" HorizontalAlignment="Center"/>
                                            <TextBlock Text="{Binding SessionsRemaining}" FontSize="20" FontWeight="Bold" Foreground="#1976D2" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                        
                                        <Button Grid.Column="3"
                                               Content="{Binding ButtonText}"
                                               Command="{Binding $parent[ItemsControl].((vm:AttendanceViewModel)DataContext).MarkCommand}"
                                               CommandParameter="{Binding}"
                                               Padding="20,8"
                                               MinWidth="100"
                                               VerticalAlignment="Center"/>
                                        
                                    </Grid>
                                    
                                    <Border Background="#FFFDE7" CornerRadius="5" Padding="10" IsVisible="{Binding IsPresent}">
                                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10">
                                            <TextBlock Grid.Column="0" Text="Коментар:" FontSize="13" VerticalAlignment="Center" Foreground="Black"/>
                                            <TextBox Grid.Column="1" Text="{Binding Notes}" Watermark="Необов'язково" FontSize="13"/>
                                            <Button Grid.Column="2"
                                                   Content="Зберегти"
                                                   Command="{Binding $parent[ItemsControl].((vm:AttendanceViewModel)DataContext).SaveNotesCommand}"
                                                   CommandParameter="{Binding}"
                                                   Padding="10,5"
                                                   FontSize="12"/>
                                        </Grid>
                                    </Border>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>
        
        <Border Background="#F9F9F9" CornerRadius="5" Padding="30" IsVisible="{Binding !HasResults}">
            <TextBlock Text="Введіть дані для пошуку" FontSize="16" Foreground="Gray" HorizontalAlignment="Center"/>
        </Border>
        
    </StackPanel>
    
</UserControl>